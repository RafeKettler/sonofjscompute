// Generated by CoffeeScript 1.7.1
(function() {
  var RESOLUTION, getImage, getX, getY, height, pixels, svg, w, width, _ref;

  pixels = [];

  w = new WebSocket('ws://localhost:8000/mosaic/');

  _ref = [1920, 1080], width = _ref[0], height = _ref[1];

  RESOLUTION = 30;

  getX = function(d) {
    return JSON.parse(d.url).x;
  };

  getY = function(d) {
    return JSON.parse(d.url).y;
  };

  getImage = function(d) {
    return JSON.parse(d.url).url.replace(/_8\.jpg/g, '_5.jpg');
  };

  svg = d3.select('body').append('svg').attr('width', width).attr('height', height);

  w.onopen = function(e) {
    return w.send('start');
  };

  w.onmessage = function(e) {
    var images, message;
    message = JSON.parse(e.data);
    pixels.push(message);
    images = svg.selectAll('image').data(pixels);
    images.enter().append('svg:image').attr({
      'xlink:href': getImage,
      x: function(d) {
        return (getX(d) + RESOLUTION) / 2;
      },
      y: function(d) {
        return (getY(d) + RESOLUTION) / 2;
      },
      width: 0,
      height: 0
    }).transition().attr({
      x: getX,
      y: getY,
      width: RESOLUTION,
      height: RESOLUTION
    });
    return images.exit().remove();
  };

  window.onUnload = function(e) {
    return w.close();
  };

}).call(this);
