// Generated by CoffeeScript 1.7.1
(function() {
  var getImage, getX, getY, pixels, w;

  pixels = [];

  w = new WebSocket('ws://localhost:8000/mosaic/');

  getX = function(d) {
    return "" + (JSON.parse(d.url).x) + "px";
  };

  getY = function(d) {
    return "" + (JSON.parse(d.url).y) + "px";
  };

  getImage = function(d) {
    return JSON.parse(d.url).url.replace(/_8\.jpg/g, '_5.jpg');
  };

  d3.select('body').append('div');

  w.onopen = function(e) {
    return w.send('start');
  };

  w.onmessage = function(e) {
    var data, message;
    message = JSON.parse(e.data);
    pixels.push(message);
    data = d3.select('body > div').selectAll('img').data(pixels);
    data.enter().append('img').attr('src', getImage).style('position', 'absolute').style('top', getY, 'important').style('left', getX, 'important');
    return data.exit().remove();
  };

  window.onUnload = function(e) {
    return w.close();
  };

}).call(this);
